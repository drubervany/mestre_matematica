{"ast":null,"code":"import { BehaviorSubject } from 'rxjs';\nimport { INITIAL_PLAYER } from '../models/player.model';\nimport * as i0 from \"@angular/core\";\nexport class GameService {\n  constructor() {\n    this.playerSubject = new BehaviorSubject(INITIAL_PLAYER);\n    this.player$ = this.playerSubject.asObservable();\n    this.player = {\n      ...INITIAL_PLAYER\n    };\n    this.load();\n  }\n  getPlayer() {\n    return {\n      ...this.player\n    };\n  }\n  // Completar missão com sucesso\n  completeMission(reward, correctAnswers, totalQuestions) {\n    const minCorrect = reward.minCorrectAnswers || Math.ceil(totalQuestions * 0.7); // 70% por padrão\n    if (correctAnswers >= minCorrect) {\n      // Missão completada com sucesso\n      this.player.xp += reward.xp;\n      this.player.coins += reward.coins || 0;\n      // Adicionar item se não tiver ainda\n      if (reward.item && !this.player.items.includes(reward.item)) {\n        this.player.items.push(reward.item);\n      }\n      this.checkLevelUp();\n      this.save();\n      this.playerSubject.next({\n        ...this.player\n      });\n      return true;\n    }\n    return false;\n  }\n  // Errar resposta - perde coração\n  loseHeart() {\n    if (this.player.hearts > 0) {\n      this.player.hearts--;\n      this.save();\n      this.playerSubject.next({\n        ...this.player\n      });\n    }\n  }\n  // Recuperar coração (desafio bônus)\n  recoverHeart() {\n    // Sempre recuperar uma vida quando acerta o bônus (até o máximo)\n    if (this.player.hearts < this.player.maxHearts) {\n      this.player.hearts++;\n      this.save();\n      this.playerSubject.next({\n        ...this.player\n      });\n    } else {\n      // Se já está no máximo, garantir que está salvo e atualizado\n      this.save();\n      this.playerSubject.next({\n        ...this.player\n      });\n    }\n  }\n  // Comprar vida com moedas\n  buyHeart() {\n    const heartCost = 10; // Custo de 10 moedas por vida\n    if (this.player.coins >= heartCost && this.player.hearts < this.player.maxHearts) {\n      this.player.coins -= heartCost;\n      this.player.hearts++;\n      this.save();\n      this.playerSubject.next({\n        ...this.player\n      });\n      return true;\n    }\n    return false;\n  }\n  // Verificar se pode fazer desafio bônus (sem corações)\n  canDoBonusChallenge() {\n    return this.player.hearts === 0;\n  }\n  // Ganhar moedas\n  addCoins(amount) {\n    this.player.coins += amount;\n    this.save();\n    this.playerSubject.next({\n      ...this.player\n    });\n  }\n  // Perder moedas\n  removeCoins(amount) {\n    this.player.coins = Math.max(0, this.player.coins - amount); // Não pode ficar negativo\n    this.save();\n    this.playerSubject.next({\n      ...this.player\n    });\n  }\n  // Verificar level up (até nível 4, 10 XP por nível)\n  checkLevelUp() {\n    const maxLevel = 4;\n    // Cada nível precisa de 10 XP (nível 1 = 0-9 XP, nível 2 = 10-19 XP, etc.)\n    while (this.player.level < maxLevel && this.player.xp >= this.player.level * 10) {\n      this.player.level++;\n      // Ganha moedas ao subir de nível\n      this.player.coins += 10;\n    }\n    if (this.player.level > 1) {\n      this.save();\n      this.playerSubject.next({\n        ...this.player\n      });\n    }\n  }\n  // Salvar no localStorage\n  save() {\n    localStorage.setItem('anthony-matematica-player', JSON.stringify(this.player));\n  }\n  // Carregar do localStorage\n  load() {\n    const data = localStorage.getItem('anthony-matematica-player');\n    if (data) {\n      try {\n        this.player = JSON.parse(data);\n        // Garantir que tem todos os campos\n        this.player = {\n          ...INITIAL_PLAYER,\n          ...this.player\n        };\n        this.playerSubject.next({\n          ...this.player\n        });\n      } catch (e) {\n        console.error('Erro ao carregar dados do jogador:', e);\n      }\n    }\n  }\n  // Resetar jogo (opcional)\n  resetGame() {\n    this.player = {\n      ...INITIAL_PLAYER\n    };\n    this.save();\n    this.playerSubject.next({\n      ...this.player\n    });\n  }\n  static {\n    this.ɵfac = function GameService_Factory(t) {\n      return new (t || GameService)();\n    };\n  }\n  static {\n    this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: GameService,\n      factory: GameService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n}","map":{"version":3,"names":["BehaviorSubject","INITIAL_PLAYER","GameService","constructor","playerSubject","player$","asObservable","player","load","getPlayer","completeMission","reward","correctAnswers","totalQuestions","minCorrect","minCorrectAnswers","Math","ceil","xp","coins","item","items","includes","push","checkLevelUp","save","next","loseHeart","hearts","recoverHeart","maxHearts","buyHeart","heartCost","canDoBonusChallenge","addCoins","amount","removeCoins","max","maxLevel","level","localStorage","setItem","JSON","stringify","data","getItem","parse","e","console","error","resetGame","factory","ɵfac","providedIn"],"sources":["C:\\Users\\Dell\\git\\Anthony\\estudo_matematica\\src\\app\\services\\game.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { BehaviorSubject, Observable } from 'rxjs';\r\nimport { Player, INITIAL_PLAYER } from '../models/player.model';\r\nimport { GameMissionReward } from '../models/game-mission.model';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class GameService {\r\n  private playerSubject = new BehaviorSubject<Player>(INITIAL_PLAYER);\r\n  public player$: Observable<Player> = this.playerSubject.asObservable();\r\n\r\n  private player: Player = { ...INITIAL_PLAYER };\r\n\r\n  constructor() {\r\n    this.load();\r\n  }\r\n\r\n  getPlayer(): Player {\r\n    return { ...this.player };\r\n  }\r\n\r\n  // Completar missão com sucesso\r\n  completeMission(reward: GameMissionReward, correctAnswers: number, totalQuestions: number): boolean {\r\n    const minCorrect = reward.minCorrectAnswers || Math.ceil(totalQuestions * 0.7); // 70% por padrão\r\n    \r\n    if (correctAnswers >= minCorrect) {\r\n      // Missão completada com sucesso\r\n      this.player.xp += reward.xp;\r\n      this.player.coins += (reward.coins || 0);\r\n      \r\n      // Adicionar item se não tiver ainda\r\n      if (reward.item && !this.player.items.includes(reward.item)) {\r\n        this.player.items.push(reward.item);\r\n      }\r\n      \r\n      this.checkLevelUp();\r\n      this.save();\r\n      this.playerSubject.next({ ...this.player });\r\n      return true;\r\n    }\r\n    \r\n    return false;\r\n  }\r\n\r\n  // Errar resposta - perde coração\r\n  loseHeart(): void {\r\n    if (this.player.hearts > 0) {\r\n      this.player.hearts--;\r\n      this.save();\r\n      this.playerSubject.next({ ...this.player });\r\n    }\r\n  }\r\n\r\n  // Recuperar coração (desafio bônus)\r\n  recoverHeart(): void {\r\n    // Sempre recuperar uma vida quando acerta o bônus (até o máximo)\r\n    if (this.player.hearts < this.player.maxHearts) {\r\n      this.player.hearts++;\r\n      this.save();\r\n      this.playerSubject.next({ ...this.player });\r\n    } else {\r\n      // Se já está no máximo, garantir que está salvo e atualizado\r\n      this.save();\r\n      this.playerSubject.next({ ...this.player });\r\n    }\r\n  }\r\n\r\n  // Comprar vida com moedas\r\n  buyHeart(): boolean {\r\n    const heartCost = 10; // Custo de 10 moedas por vida\r\n    if (this.player.coins >= heartCost && this.player.hearts < this.player.maxHearts) {\r\n      this.player.coins -= heartCost;\r\n      this.player.hearts++;\r\n      this.save();\r\n      this.playerSubject.next({ ...this.player });\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  // Verificar se pode fazer desafio bônus (sem corações)\r\n  canDoBonusChallenge(): boolean {\r\n    return this.player.hearts === 0;\r\n  }\r\n\r\n  // Ganhar moedas\r\n  addCoins(amount: number): void {\r\n    this.player.coins += amount;\r\n    this.save();\r\n    this.playerSubject.next({ ...this.player });\r\n  }\r\n\r\n  // Perder moedas\r\n  removeCoins(amount: number): void {\r\n    this.player.coins = Math.max(0, this.player.coins - amount); // Não pode ficar negativo\r\n    this.save();\r\n    this.playerSubject.next({ ...this.player });\r\n  }\r\n\r\n  // Verificar level up (até nível 4, 10 XP por nível)\r\n  private checkLevelUp(): void {\r\n    const maxLevel = 4;\r\n    \r\n    // Cada nível precisa de 10 XP (nível 1 = 0-9 XP, nível 2 = 10-19 XP, etc.)\r\n    while (this.player.level < maxLevel && this.player.xp >= this.player.level * 10) {\r\n      this.player.level++;\r\n      // Ganha moedas ao subir de nível\r\n      this.player.coins += 10;\r\n    }\r\n    \r\n    if (this.player.level > 1) {\r\n      this.save();\r\n      this.playerSubject.next({ ...this.player });\r\n    }\r\n  }\r\n\r\n  // Salvar no localStorage\r\n  private save(): void {\r\n    localStorage.setItem('anthony-matematica-player', JSON.stringify(this.player));\r\n  }\r\n\r\n  // Carregar do localStorage\r\n  load(): void {\r\n    const data = localStorage.getItem('anthony-matematica-player');\r\n    if (data) {\r\n      try {\r\n        this.player = JSON.parse(data);\r\n        // Garantir que tem todos os campos\r\n        this.player = { ...INITIAL_PLAYER, ...this.player };\r\n        this.playerSubject.next({ ...this.player });\r\n      } catch (e) {\r\n        console.error('Erro ao carregar dados do jogador:', e);\r\n      }\r\n    }\r\n  }\r\n\r\n  // Resetar jogo (opcional)\r\n  resetGame(): void {\r\n    this.player = { ...INITIAL_PLAYER };\r\n    this.save();\r\n    this.playerSubject.next({ ...this.player });\r\n  }\r\n}\r\n\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}