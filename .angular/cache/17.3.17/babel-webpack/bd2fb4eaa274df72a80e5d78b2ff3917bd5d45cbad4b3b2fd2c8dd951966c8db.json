{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nlet MissionDetailComponent = class MissionDetailComponent {\n  constructor(route, router, missionsService, gameService, rewardsService) {\n    this.route = route;\n    this.router = router;\n    this.missionsService = missionsService;\n    this.gameService = gameService;\n    this.rewardsService = rewardsService;\n    this.allActivitiesCompleted = false;\n    this.showOriginalImage = false;\n    this.selectedMatches = {};\n    this.selectedImageForMatch = {};\n    this.shuffledMatchPairs = {};\n    this.shuffledOptions = {};\n    this.environmentAnswers = {};\n    this.inputAnswers = {}; // Respostas dos campos de input\n    this.cduAnswers = {}; // Respostas C D U\n    this.correctAnswers = 0;\n    this.totalQuestions = 0;\n    this.wrongAnswers = 0;\n    this.showBonusChallenge = false;\n    this.bonusChallengeCompleted = false;\n    this.completedActivities = [];\n    this.bonusAnswerSelected = null;\n    this.showHeartAnimation = false;\n    this.showFinalCard = false;\n    this.showCoinsLossCard = false;\n    this.coinsLost = 0;\n  }\n  ngOnInit() {\n    this.route.paramMap.subscribe(params => {\n      const id = Number(params.get('id'));\n      this.loadMission(id);\n    });\n    this.gameService.player$.subscribe(player => {\n      if (this.showBonusChallenge && !this.bonusChallengeCompleted && player.hearts > 0) {\n        this.bonusChallengeCompleted = true;\n        this.showBonusChallenge = false;\n        this.enableAllActivities();\n      }\n    });\n  }\n  loadMission(id) {\n    this.mission = this.missionsService.getMissionById(id);\n    this.allActivitiesCompleted = false;\n    this.showOriginalImage = !(this.mission?.textContent || this.mission?.textImages);\n    this.selectedMatches = {};\n    this.selectedImageForMatch = {};\n    this.environmentAnswers = {};\n    this.shuffledMatchPairs = {};\n    this.shuffledOptions = {};\n    this.inputAnswers = {};\n    this.cduAnswers = {};\n    if (this.mission) {\n      this.mission.activities.forEach((activity, activityIndex) => {\n        if (activity.type === 'match' && activity.matchPairs) {\n          this.shuffleMatchPairs(activityIndex, activity.matchPairs);\n        } else if (activity.type === 'multiple-choice' && activity.options) {\n          this.shuffleOptions(activityIndex, activity.options);\n        }\n      });\n    }\n    this.correctAnswers = 0;\n    this.totalQuestions = 0;\n    if (this.mission) {\n      this.mission.activities.forEach(activity => {\n        if (activity.type === 'match' && activity.matchPairs) {\n          this.totalQuestions += activity.matchPairs.length;\n        } else {\n          this.totalQuestions += 1;\n        }\n      });\n    }\n    this.wrongAnswers = 0;\n    this.showBonusChallenge = false;\n    this.bonusChallengeCompleted = false;\n    this.bonusAnswerSelected = null;\n    this.showHeartAnimation = false;\n    this.showCoinsLossCard = false;\n    this.coinsLost = 0;\n    this.completedActivities = new Array(this.totalQuestions).fill(false);\n    if (!this.mission) {\n      this.router.navigate(['/missions']);\n      return;\n    }\n    setTimeout(() => {\n      const buttons = document.querySelectorAll('.activity-item .option-btn');\n      buttons.forEach(btn => {\n        btn.disabled = false;\n        btn.classList.remove('correct', 'incorrect', 'selected');\n      });\n      const successSection = document.getElementById('success-section');\n      if (successSection) {\n        successSection.style.display = 'none';\n      }\n    }, 100);\n  }\n  toggleOriginalImage() {\n    this.showOriginalImage = !this.showOriginalImage;\n  }\n  getTextParagraphs() {\n    if (!this.mission || !this.mission.textContent) {\n      return [];\n    }\n    return this.mission.textContent.split('\\n').filter(p => p.trim());\n  }\n  hasImagesInOptions(activity) {\n    return activity.options?.some(opt => !!opt.image) || false;\n  }\n  goBack() {\n    this.router.navigate(['/missions']);\n  }\n  checkAnswer(activityIndex, optionIndex, isCorrect, option) {\n    if (!this.mission) return;\n    const player = this.gameService.getPlayer();\n    if (player.hearts === 0 && !this.bonusChallengeCompleted) {\n      this.checkForBonusChallenge();\n      return;\n    }\n    if (this.showBonusChallenge && !this.bonusChallengeCompleted) {\n      return;\n    }\n    const activity = this.mission.activities[activityIndex];\n    const options = this.shuffledOptions[activityIndex] || activity.options || [];\n    const buttons = document.querySelectorAll(`.activity-item:nth-child(${activityIndex + 1}) .option-btn`);\n    if (activity.allowMultiple) {\n      const clickedBtn = buttons[optionIndex];\n      const wasSelected = clickedBtn.classList.contains('selected');\n      if (wasSelected) {\n        clickedBtn.classList.remove('selected', isCorrect ? 'correct' : 'incorrect');\n      } else {\n        clickedBtn.classList.add('selected');\n        clickedBtn.classList.add(isCorrect ? 'correct' : 'incorrect');\n        if (!isCorrect) {\n          this.wrongAnswers++;\n          this.gameService.loseHeart();\n          this.checkForBonusChallenge();\n        }\n      }\n      const allCorrectSelected = options.every((opt, idx) => {\n        if (opt.correct) {\n          return buttons[idx].classList.contains('selected');\n        }\n        return true;\n      });\n      const noIncorrectSelected = options.every((opt, idx) => {\n        if (!opt.correct) {\n          return !buttons[idx].classList.contains('selected');\n        }\n        return true;\n      });\n      const activityCorrect = allCorrectSelected && noIncorrectSelected;\n      if (allCorrectSelected && activityCorrect && !this.completedActivities[activityIndex]) {\n        this.completedActivities[activityIndex] = true;\n        this.correctAnswers++;\n        buttons.forEach(btn => {\n          btn.disabled = true;\n          options.forEach((opt, idx) => {\n            if (!opt.correct && !buttons[idx].classList.contains('selected')) {\n              buttons[idx].classList.add('incorrect');\n            }\n          });\n        });\n        this.checkAllActivitiesCompleted();\n      } else if (!activityCorrect && this.completedActivities[activityIndex]) {\n        this.completedActivities[activityIndex] = false;\n        this.correctAnswers--;\n      } else if (activityCorrect) {\n        this.checkAllActivitiesCompleted();\n      }\n    } else {\n      buttons.forEach((btn, index) => {\n        btn.disabled = true;\n        const currentOption = options[index];\n        if (index === optionIndex) {\n          btn.classList.add(isCorrect ? 'correct' : 'incorrect');\n        } else if (isCorrect) {\n          if (currentOption && currentOption.correct) {\n            btn.classList.add('correct');\n          }\n        }\n      });\n      if (isCorrect && !this.completedActivities[activityIndex]) {\n        this.completedActivities[activityIndex] = true;\n        this.correctAnswers++;\n      } else if (!isCorrect) {\n        this.wrongAnswers++;\n        this.gameService.loseHeart();\n        this.checkForBonusChallenge();\n      }\n      this.checkAllActivitiesCompleted();\n    }\n  }\n  checkForBonusChallenge() {\n    const player = this.gameService.getPlayer();\n    if (player.hearts === 0 && !this.bonusChallengeCompleted) {\n      if (!this.showBonusChallenge) {\n        this.showBonusChallenge = true;\n        this.disableAllActivities();\n        const successSection = document.getElementById('success-section');\n        if (successSection) {\n          successSection.style.display = 'none';\n        }\n        window.scrollTo({\n          top: 0,\n          behavior: 'smooth'\n        });\n      }\n    }\n  }\n  closeBonusPopup() {\n    // Não permitir fechar o popup sem completar o desafio\n    // O popup só fecha quando o desafio é completado\n  }\n  disableAllActivities() {\n    if (!this.mission) return;\n    this.mission.activities.forEach((activity, activityIndex) => {\n      const buttons = document.querySelectorAll(`.activity-item:nth-child(${activityIndex + 1}) .option-btn`);\n      buttons.forEach(btn => {\n        if (!btn.disabled || !btn.classList.contains('correct')) {\n          btn.disabled = true;\n          btn.style.opacity = '0.5';\n          btn.style.cursor = 'not-allowed';\n        }\n      });\n    });\n  }\n  enableAllActivities() {\n    if (!this.mission) return;\n    this.mission.activities.forEach((activity, activityIndex) => {\n      if (!this.completedActivities[activityIndex]) {\n        const buttons = document.querySelectorAll(`.activity-item:nth-child(${activityIndex + 1}) .option-btn`);\n        buttons.forEach(btn => {\n          if (!btn.classList.contains('correct')) {\n            btn.disabled = false;\n            btn.style.opacity = '1';\n            btn.style.cursor = 'pointer';\n          }\n        });\n      }\n    });\n  }\n  checkTrueFalse(activityIndex, userAnswer, isCorrect) {\n    if (!this.mission) return;\n    const player = this.gameService.getPlayer();\n    if (player.hearts === 0 && !this.bonusChallengeCompleted) {\n      this.checkForBonusChallenge();\n      return;\n    }\n    if (this.showBonusChallenge && !this.bonusChallengeCompleted) {\n      return;\n    }\n    const isActivityCorrect = isCorrect === userAnswer;\n    if (isActivityCorrect && !this.completedActivities[activityIndex]) {\n      this.completedActivities[activityIndex] = true;\n      this.correctAnswers++;\n    } else if (!isActivityCorrect) {\n      this.wrongAnswers++;\n      this.gameService.loseHeart();\n      this.checkForBonusChallenge();\n    }\n    const buttons = document.querySelectorAll(`.activity-item:nth-child(${activityIndex + 1}) .option-btn`);\n    buttons.forEach(btn => {\n      btn.disabled = true;\n      const isTrueBtn = btn.textContent.includes('Verdadeiro');\n      if (isTrueBtn && userAnswer || !isTrueBtn && !userAnswer) {\n        btn.classList.add(isCorrect ? 'correct' : 'incorrect');\n      } else {\n        btn.classList.add(!isCorrect ? 'correct' : 'incorrect');\n      }\n    });\n    this.checkAllActivitiesCompleted();\n  }\n  checkAllActivitiesCompleted() {\n    if (!this.mission) return;\n    let allCompleted = true;\n    this.mission.activities.forEach((activity, activityIndex) => {\n      if (activity.type === 'multiple-choice' || activity.type === 'true-false') {\n        if (activity.allowMultiple) {\n          if (!this.completedActivities[activityIndex]) {\n            allCompleted = false;\n          }\n        } else {\n          const buttons = document.querySelectorAll(`.activity-item:nth-child(${activityIndex + 1}) .option-btn`);\n          const allDisabled = Array.from(buttons).every(btn => btn.disabled);\n          if (!allDisabled) {\n            allCompleted = false;\n          }\n        }\n      } else if (activity.type === 'match') {\n        if (activity.matchPairs) {\n          const allMatched = activity.matchPairs.every((pair, idx) => {\n            const key = `${activityIndex}-${pair.matchId}`;\n            return this.selectedMatches[key] === pair.description;\n          });\n          if (!allMatched) {\n            allCompleted = false;\n          }\n        }\n      } else if (activity.type === 'environment-check') {\n        if (activity.environmentImages) {\n          const allAnswered = activity.environmentImages.every((_, idx) => {\n            return this.environmentAnswers[idx] !== null && this.environmentAnswers[idx] !== undefined;\n          });\n          if (!allAnswered) {\n            allCompleted = false;\n          }\n        }\n      } else if (activity.type === 'fill-blank' || activity.type === 'math-input') {\n        if (!this.completedActivities[activityIndex]) {\n          allCompleted = false;\n        }\n      } else if (activity.type === 'cdu-operation') {\n        if (!this.completedActivities[activityIndex]) {\n          allCompleted = false;\n        }\n      } else if (activity.type === 'visual-multiplication') {\n        if (!this.completedActivities[activityIndex]) {\n          allCompleted = false;\n        }\n      }\n    });\n    if (allCompleted && !this.allActivitiesCompleted) {\n      this.allActivitiesCompleted = true;\n      const player = this.gameService.getPlayer();\n      if (player.hearts === 0 && !this.bonusChallengeCompleted) {\n        this.checkForBonusChallenge();\n        return;\n      }\n      setTimeout(() => {\n        this.showSuccessMessage();\n      }, 1000);\n    }\n  }\n  showSuccessMessage() {\n    if (this.mission) {\n      if (this.showBonusChallenge && !this.bonusChallengeCompleted) {\n        return;\n      }\n      this.missionsService.markMissionAsCompleted(this.mission.id);\n      const reward = this.rewardsService.getReward(this.mission.id);\n      if (reward) {\n        this.gameService.completeMission(reward, this.correctAnswers, this.totalQuestions);\n      }\n      const successSection = document.getElementById('success-section');\n      if (successSection) {\n        successSection.style.display = 'block';\n        successSection.scrollIntoView({\n          behavior: 'smooth'\n        });\n      }\n    }\n  }\n  selectBonusAnswer(answer) {\n    this.bonusAnswerSelected = answer;\n  }\n  completeBonusChallenge() {\n    if (!this.mission || !this.bonusAnswerSelected) return;\n    let correctAnswer;\n    if (this.mission.bonusQuestion) {\n      correctAnswer = this.mission.bonusCorrectAnswer || \"Sim\";\n    } else {\n      correctAnswer = \"Somar um número várias vezes\";\n    }\n    const isCorrect = this.bonusAnswerSelected === correctAnswer;\n    if (isCorrect) {\n      this.gameService.recoverHeart();\n      this.bonusChallengeCompleted = true;\n      this.showBonusChallenge = false;\n      this.enableAllActivities();\n      this.showHeartAnimation = true;\n      setTimeout(() => {\n        this.showHeartAnimation = false;\n        if (this.allActivitiesCompleted) {\n          this.showSuccessMessage();\n        } else {\n          this.checkAllActivitiesCompleted();\n        }\n      }, 3000);\n    } else {\n      const player = this.gameService.getPlayer();\n      const livesLost = player.maxHearts - player.hearts;\n      const coinsToDeduct = livesLost * 3;\n      if (coinsToDeduct > 0) {\n        this.coinsLost = coinsToDeduct;\n        this.gameService.removeCoins(coinsToDeduct);\n        this.showCoinsLossCard = true;\n        setTimeout(() => {\n          this.showCoinsLossCard = false;\n        }, 3000);\n      }\n      this.bonusAnswerSelected = null;\n      this.showBonusChallenge = true;\n      this.disableAllActivities();\n      window.scrollTo({\n        top: 0,\n        behavior: 'smooth'\n      });\n    }\n  }\n  nextMission() {\n    if (!this.mission) return;\n    const nextId = this.mission.id + 1;\n    const nextMission = this.missionsService.getMissionById(nextId);\n    if (nextMission) {\n      this.router.navigate(['/mission', nextId]).then(() => {\n        window.scrollTo({\n          top: 0,\n          behavior: 'smooth'\n        });\n      });\n    } else {\n      this.showFinalCard = true;\n      window.scrollTo({\n        top: 0,\n        behavior: 'smooth'\n      });\n    }\n  }\n  closeFinalCard() {\n    this.showFinalCard = false;\n    this.router.navigate(['/missions']);\n  }\n  shuffleOptions(activityIndex, options) {\n    const shuffle = array => {\n      const shuffled = [...array];\n      for (let i = shuffled.length - 1; i > 0; i--) {\n        const j = Math.floor(Math.random() * (i + 1));\n        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];\n      }\n      return shuffled;\n    };\n    this.shuffledOptions[activityIndex] = shuffle(options);\n  }\n  shuffleMatchPairs(activityIndex, matchPairs) {\n    const images = [...matchPairs];\n    const texts = [...matchPairs];\n    const shuffle = array => {\n      const shuffled = [...array];\n      for (let i = shuffled.length - 1; i > 0; i--) {\n        const j = Math.floor(Math.random() * (i + 1));\n        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];\n      }\n      return shuffled;\n    };\n    this.shuffledMatchPairs[activityIndex] = {\n      images: shuffle(images),\n      texts: shuffle(texts)\n    };\n  }\n  selectImageForMatch(activityIndex, imageId) {\n    if (!this.mission) return;\n    const player = this.gameService.getPlayer();\n    if (player.hearts === 0 && !this.bonusChallengeCompleted) {\n      this.checkForBonusChallenge();\n      return;\n    }\n    if (this.showBonusChallenge && !this.bonusChallengeCompleted) {\n      return;\n    }\n    if (this.selectedImageForMatch[activityIndex] === imageId) {\n      this.selectedImageForMatch[activityIndex] = null;\n    } else {\n      this.selectedImageForMatch[activityIndex] = imageId;\n    }\n  }\n  selectMatch(activityIndex, imageId, description) {\n    if (!this.mission) return;\n    const player = this.gameService.getPlayer();\n    if (player.hearts === 0 && !this.bonusChallengeCompleted) {\n      this.checkForBonusChallenge();\n      return;\n    }\n    if (this.showBonusChallenge && !this.bonusChallengeCompleted) {\n      return;\n    }\n    if (!this.selectedImageForMatch[activityIndex]) {\n      return;\n    }\n    const selectedImageId = this.selectedImageForMatch[activityIndex];\n    const key = `${activityIndex}-${selectedImageId}`;\n    const activity = this.mission.activities[activityIndex];\n    if (activity.matchPairs) {\n      const correctPair = activity.matchPairs.find(pair => pair.matchId === selectedImageId);\n      const isCorrect = correctPair && correctPair.description === description;\n      if (isCorrect) {\n        const wasAlreadyMatched = this.selectedMatches[key] !== undefined;\n        this.selectedMatches[key] = description;\n        if (!wasAlreadyMatched) {\n          this.correctAnswers++;\n        }\n        this.selectedImageForMatch[activityIndex] = null;\n      } else {\n        this.wrongAnswers++;\n        this.gameService.loseHeart();\n        this.checkForBonusChallenge();\n        this.selectedImageForMatch[activityIndex] = null;\n      }\n      const allCorrect = activity.matchPairs.every(pair => {\n        const matchKey = `${activityIndex}-${pair.matchId}`;\n        return this.selectedMatches[matchKey] === pair.description;\n      });\n      const allMatched = activity.matchPairs.every(pair => {\n        const matchKey = `${activityIndex}-${pair.matchId}`;\n        return this.selectedMatches[matchKey] !== undefined;\n      });\n      if (allCorrect && allMatched && !this.completedActivities[activityIndex]) {\n        this.completedActivities[activityIndex] = true;\n        this.checkAllActivitiesCompleted();\n      } else if ((!allCorrect || !allMatched) && this.completedActivities[activityIndex]) {\n        this.completedActivities[activityIndex] = false;\n      }\n    }\n  }\n  checkEnvironment(activityIndex, imageIndex, hasProblem) {\n    if (!this.mission) return;\n    const player = this.gameService.getPlayer();\n    if (player.hearts === 0 && !this.bonusChallengeCompleted) {\n      this.checkForBonusChallenge();\n      return;\n    }\n    if (this.showBonusChallenge && !this.bonusChallengeCompleted) {\n      return;\n    }\n    const activity = this.mission.activities[activityIndex];\n    if (activity.type === 'environment-check' && activity.environmentImages) {\n      this.environmentAnswers[imageIndex] = hasProblem;\n      const correct = activity.environmentImages[imageIndex].hasProblem === hasProblem;\n      const allAnswered = activity.environmentImages.every((img, idx) => {\n        return this.environmentAnswers[idx] !== null && this.environmentAnswers[idx] !== undefined;\n      });\n      let allImagesCorrect = true;\n      for (let i = 0; i < activity.environmentImages.length; i++) {\n        const img = activity.environmentImages[i];\n        const userAnswer = this.environmentAnswers[i];\n        if (userAnswer === null || userAnswer === undefined) {\n          allImagesCorrect = false;\n          break;\n        }\n        if (userAnswer !== img.hasProblem) {\n          allImagesCorrect = false;\n          break;\n        }\n      }\n      if (allImagesCorrect && allAnswered && !this.completedActivities[activityIndex]) {\n        this.completedActivities[activityIndex] = true;\n        this.correctAnswers++;\n        this.checkAllActivitiesCompleted();\n      } else if ((!allImagesCorrect || !allAnswered) && this.completedActivities[activityIndex]) {\n        this.completedActivities[activityIndex] = false;\n        this.correctAnswers--;\n      } else if (!correct) {\n        this.wrongAnswers++;\n        this.gameService.loseHeart();\n        this.checkForBonusChallenge();\n      }\n    }\n  }\n  isEnvironmentCorrect(imageIndex) {\n    return this.environmentAnswers[imageIndex] ?? null;\n  }\n  getCurrentHeartsArray() {\n    const player = this.gameService.getPlayer();\n    return Array(player.maxHearts).fill(false).map((_, i) => i < player.hearts);\n  }\n  // Métodos para campos de input\n  getInputKey(activityIndex, fieldIndex) {\n    return `${activityIndex}-${fieldIndex}`;\n  }\n  getInputValue(activityIndex, fieldIndex) {\n    return this.inputAnswers[this.getInputKey(activityIndex, fieldIndex)] || '';\n  }\n  setInputValue(activityIndex, fieldIndex, value) {\n    const key = this.getInputKey(activityIndex, fieldIndex);\n    this.inputAnswers[key] = value;\n    // Verificar tipo de atividade\n    if (this.mission) {\n      const activity = this.mission.activities[activityIndex];\n      if (activity.type === 'visual-multiplication') {\n        setTimeout(() => {\n          this.checkVisualMultiplication(activityIndex);\n        }, 100);\n      } else {\n        this.checkInputActivity(activityIndex);\n      }\n    }\n  }\n  checkInputActivity(activityIndex) {\n    if (!this.mission) return;\n    const player = this.gameService.getPlayer();\n    if (player.hearts === 0 && !this.bonusChallengeCompleted) {\n      this.checkForBonusChallenge();\n      return;\n    }\n    if (this.showBonusChallenge && !this.bonusChallengeCompleted) {\n      return;\n    }\n    const activity = this.mission.activities[activityIndex];\n    if (activity.type === 'fill-blank' || activity.type === 'math-input') {\n      if (activity.inputFields) {\n        // Verificar se todos os campos estão preenchidos\n        let allFilled = true;\n        activity.inputFields.forEach((field, fieldIndex) => {\n          const key = this.getInputKey(activityIndex, fieldIndex);\n          const userAnswer = this.inputAnswers[key] || '';\n          if (!userAnswer.trim()) {\n            allFilled = false;\n          }\n        });\n        if (!allFilled) {\n          return; // Ainda não preencheu tudo\n        }\n        let allCorrect = true;\n        let hasError = false;\n        activity.inputFields.forEach((field, fieldIndex) => {\n          const key = this.getInputKey(activityIndex, fieldIndex);\n          const userAnswer = this.inputAnswers[key] || '';\n          const correctValue = String(field.correctValue).trim().toLowerCase();\n          const userValue = userAnswer.trim().toLowerCase();\n          if (userValue !== correctValue) {\n            allCorrect = false;\n            hasError = true;\n          }\n        });\n        if (allCorrect && !this.completedActivities[activityIndex]) {\n          this.completedActivities[activityIndex] = true;\n          this.correctAnswers++;\n          this.checkAllActivitiesCompleted();\n        } else if (!allCorrect && this.completedActivities[activityIndex]) {\n          this.completedActivities[activityIndex] = false;\n          this.correctAnswers--;\n        } else if (hasError && !this.completedActivities[activityIndex]) {\n          // Erro ao tentar completar - perde uma vida\n          this.wrongAnswers++;\n          this.gameService.loseHeart();\n          this.checkForBonusChallenge();\n        }\n      }\n    } else if (activity.type === 'cdu-operation' && activity.cduOperation) {\n      const op = activity.cduOperation;\n      const key = `${activityIndex}-cdu`;\n      const userCDU = this.cduAnswers[key];\n      if (userCDU && userCDU.centena && userCDU.dezena && userCDU.unidade) {\n        const userCentena = parseInt(userCDU.centena) || 0;\n        const userDezena = parseInt(userCDU.dezena) || 0;\n        const userUnidade = parseInt(userCDU.unidade) || 0;\n        const userAnswer = userCentena * 100 + userDezena * 10 + userUnidade;\n        const correct = userAnswer === op.correctAnswer;\n        if (correct && !this.completedActivities[activityIndex]) {\n          this.completedActivities[activityIndex] = true;\n          this.correctAnswers++;\n          this.checkAllActivitiesCompleted();\n        } else if (!correct && this.completedActivities[activityIndex]) {\n          this.completedActivities[activityIndex] = false;\n          this.correctAnswers--;\n        } else if (!correct && !this.completedActivities[activityIndex]) {\n          // Erro ao tentar completar - perde uma vida\n          this.wrongAnswers++;\n          this.gameService.loseHeart();\n          this.checkForBonusChallenge();\n        }\n      }\n    }\n  }\n  getCDUValue(activityIndex, position) {\n    const key = `${activityIndex}-cdu`;\n    return this.cduAnswers[key]?.[position] || '';\n  }\n  setCDUValue(activityIndex, position, value) {\n    const key = `${activityIndex}-cdu`;\n    if (!this.cduAnswers[key]) {\n      this.cduAnswers[key] = {\n        centena: '',\n        dezena: '',\n        unidade: ''\n      };\n    }\n    this.cduAnswers[key][position] = value;\n    this.checkInputActivity(activityIndex);\n  }\n  isCDUCorrect(activityIndex) {\n    if (!this.mission) return null;\n    const activity = this.mission.activities[activityIndex];\n    if (activity.type !== 'cdu-operation' || !activity.cduOperation) return null;\n    const key = `${activityIndex}-cdu`;\n    const userCDU = this.cduAnswers[key];\n    if (!userCDU || !userCDU.centena || !userCDU.dezena || !userCDU.unidade) return null;\n    const userCentena = parseInt(userCDU.centena) || 0;\n    const userDezena = parseInt(userCDU.dezena) || 0;\n    const userUnidade = parseInt(userCDU.unidade) || 0;\n    const userAnswer = userCentena * 100 + userDezena * 10 + userUnidade;\n    return userAnswer === activity.cduOperation.correctAnswer;\n  }\n  isInputFieldCorrect(activityIndex, fieldIndex) {\n    if (!this.mission) return null;\n    const activity = this.mission.activities[activityIndex];\n    if (activity.type !== 'fill-blank' && activity.type !== 'math-input' || !activity.inputFields) return null;\n    const field = activity.inputFields[fieldIndex];\n    if (!field) return null;\n    const key = this.getInputKey(activityIndex, fieldIndex);\n    const userAnswer = this.inputAnswers[key] || '';\n    if (!userAnswer) return null;\n    const correctValue = String(field.correctValue).trim().toLowerCase();\n    const userValue = userAnswer.trim().toLowerCase();\n    return userValue === correctValue;\n  }\n  getCDUDisplay(number, position) {\n    const str = String(number).padStart(3, '0');\n    return str[position] || '0';\n  }\n  // Métodos para Visual Multiplication\n  checkVisualMultiplication(activityIndex) {\n    if (!this.mission) return;\n    const player = this.gameService.getPlayer();\n    if (player.hearts === 0 && !this.bonusChallengeCompleted) {\n      this.checkForBonusChallenge();\n      return;\n    }\n    if (this.showBonusChallenge && !this.bonusChallengeCompleted) {\n      return;\n    }\n    const activity = this.mission.activities[activityIndex];\n    if (activity.type !== 'visual-multiplication' || !activity.visualMultiplication) return;\n    const vm = activity.visualMultiplication;\n    // Verificar se todos os campos estão preenchidos\n    let allFilled = true;\n    vm.inputFields.forEach((field, fieldIndex) => {\n      const key = this.getInputKey(activityIndex, fieldIndex);\n      const userAnswer = this.inputAnswers[key] || '';\n      if (!userAnswer.trim()) {\n        allFilled = false;\n      }\n    });\n    if (!allFilled) {\n      return; // Ainda não preencheu tudo\n    }\n    // Construir a resposta do usuário\n    const num1 = this.inputAnswers[this.getInputKey(activityIndex, 0)] || '';\n    const num2 = this.inputAnswers[this.getInputKey(activityIndex, 1)] || '';\n    const result = this.inputAnswers[this.getInputKey(activityIndex, 2)] || '';\n    const userAnswer1 = `${num1} x ${num2} = ${result}`;\n    const userAnswer2 = `${num2} x ${num1} = ${result}`;\n    // Verificar se a resposta está nas respostas corretas\n    const isCorrect = vm.correctAnswers.some(correct => {\n      const normalizedCorrect = correct.trim().toLowerCase();\n      return normalizedCorrect === userAnswer1.trim().toLowerCase() || normalizedCorrect === userAnswer2.trim().toLowerCase();\n    });\n    if (isCorrect && !this.completedActivities[activityIndex]) {\n      this.completedActivities[activityIndex] = true;\n      this.correctAnswers++;\n      this.checkAllActivitiesCompleted();\n    } else if (!isCorrect && this.completedActivities[activityIndex]) {\n      this.completedActivities[activityIndex] = false;\n      this.correctAnswers--;\n    } else if (!isCorrect && !this.completedActivities[activityIndex]) {\n      // Erro ao tentar completar - perde uma vida\n      this.wrongAnswers++;\n      this.gameService.loseHeart();\n      this.checkForBonusChallenge();\n    }\n  }\n  getVisualMultiplicationValue(activityIndex, fieldIndex) {\n    return this.getInputValue(activityIndex, fieldIndex);\n  }\n  setVisualMultiplicationValue(activityIndex, fieldIndex, value) {\n    this.setInputValue(activityIndex, fieldIndex, value);\n    // Verificar após atualizar\n    setTimeout(() => {\n      this.checkVisualMultiplication(activityIndex);\n    }, 100);\n  }\n  isVisualMultiplicationCorrect(activityIndex) {\n    if (!this.mission) return null;\n    const activity = this.mission.activities[activityIndex];\n    if (activity.type !== 'visual-multiplication' || !activity.visualMultiplication) return null;\n    const vm = activity.visualMultiplication;\n    const num1 = this.inputAnswers[this.getInputKey(activityIndex, 0)] || '';\n    const num2 = this.inputAnswers[this.getInputKey(activityIndex, 1)] || '';\n    const result = this.inputAnswers[this.getInputKey(activityIndex, 2)] || '';\n    if (!num1 || !num2 || !result) return null;\n    const userAnswer1 = `${num1} x ${num2} = ${result}`;\n    const userAnswer2 = `${num2} x ${num1} = ${result}`;\n    const isCorrect = vm.correctAnswers.some(correct => {\n      const normalizedCorrect = correct.trim().toLowerCase();\n      return normalizedCorrect === userAnswer1.trim().toLowerCase() || normalizedCorrect === userAnswer2.trim().toLowerCase();\n    });\n    return isCorrect;\n  }\n};\nMissionDetailComponent = __decorate([Component({\n  selector: 'app-mission-detail',\n  templateUrl: './mission-detail.component.html',\n  styleUrls: ['./mission-detail.component.css']\n})], MissionDetailComponent);\nexport { MissionDetailComponent };","map":{"version":3,"names":["Component","MissionDetailComponent","constructor","route","router","missionsService","gameService","rewardsService","allActivitiesCompleted","showOriginalImage","selectedMatches","selectedImageForMatch","shuffledMatchPairs","shuffledOptions","environmentAnswers","inputAnswers","cduAnswers","correctAnswers","totalQuestions","wrongAnswers","showBonusChallenge","bonusChallengeCompleted","completedActivities","bonusAnswerSelected","showHeartAnimation","showFinalCard","showCoinsLossCard","coinsLost","ngOnInit","paramMap","subscribe","params","id","Number","get","loadMission","player$","player","hearts","enableAllActivities","mission","getMissionById","textContent","textImages","activities","forEach","activity","activityIndex","type","matchPairs","shuffleMatchPairs","options","shuffleOptions","length","Array","fill","navigate","setTimeout","buttons","document","querySelectorAll","btn","disabled","classList","remove","successSection","getElementById","style","display","toggleOriginalImage","getTextParagraphs","split","filter","p","trim","hasImagesInOptions","some","opt","image","goBack","checkAnswer","optionIndex","isCorrect","option","getPlayer","checkForBonusChallenge","allowMultiple","clickedBtn","wasSelected","contains","add","loseHeart","allCorrectSelected","every","idx","correct","noIncorrectSelected","activityCorrect","checkAllActivitiesCompleted","index","currentOption","disableAllActivities","window","scrollTo","top","behavior","closeBonusPopup","opacity","cursor","checkTrueFalse","userAnswer","isActivityCorrect","isTrueBtn","includes","allCompleted","allDisabled","from","allMatched","pair","key","matchId","description","environmentImages","allAnswered","_","undefined","showSuccessMessage","markMissionAsCompleted","reward","getReward","completeMission","scrollIntoView","selectBonusAnswer","answer","completeBonusChallenge","correctAnswer","bonusQuestion","bonusCorrectAnswer","recoverHeart","livesLost","maxHearts","coinsToDeduct","removeCoins","nextMission","nextId","then","closeFinalCard","shuffle","array","shuffled","i","j","Math","floor","random","images","texts","selectImageForMatch","imageId","selectMatch","selectedImageId","correctPair","find","wasAlreadyMatched","allCorrect","matchKey","checkEnvironment","imageIndex","hasProblem","img","allImagesCorrect","isEnvironmentCorrect","getCurrentHeartsArray","map","getInputKey","fieldIndex","getInputValue","setInputValue","value","checkVisualMultiplication","checkInputActivity","inputFields","allFilled","field","hasError","correctValue","String","toLowerCase","userValue","cduOperation","op","userCDU","centena","dezena","unidade","userCentena","parseInt","userDezena","userUnidade","getCDUValue","position","setCDUValue","isCDUCorrect","isInputFieldCorrect","getCDUDisplay","number","str","padStart","visualMultiplication","vm","num1","num2","result","userAnswer1","userAnswer2","normalizedCorrect","getVisualMultiplicationValue","setVisualMultiplicationValue","isVisualMultiplicationCorrect","__decorate","selector","templateUrl","styleUrls"],"sources":["C:\\Users\\Dell\\git\\Anthony\\estudo_matematica\\src\\app\\components\\mission-detail\\mission-detail.component.ts"],"sourcesContent":["import { Component, OnInit } from '@angular/core';\r\nimport { ActivatedRoute, Router } from '@angular/router';\r\nimport { MissionsService } from '../../services/missions.service';\r\nimport { GameService } from '../../services/game.service';\r\nimport { MissionRewardsService } from '../../services/mission-rewards.service';\r\nimport { Mission, Activity } from '../../models/mission.model';\r\n\r\n@Component({\r\n  selector: 'app-mission-detail',\r\n  templateUrl: './mission-detail.component.html',\r\n  styleUrls: ['./mission-detail.component.css']\r\n})\r\nexport class MissionDetailComponent implements OnInit {\r\n  mission: Mission | undefined;\r\n  allActivitiesCompleted = false;\r\n  showOriginalImage = false;\r\n  selectedMatches: { [key: string]: string } = {};\r\n  selectedImageForMatch: { [activityIndex: number]: string | null } = {};\r\n  shuffledMatchPairs: { [activityIndex: number]: { images: any[], texts: any[] } } = {};\r\n  shuffledOptions: { [activityIndex: number]: any[] } = {};\r\n  environmentAnswers: { [key: number]: boolean | null } = {};\r\n  inputAnswers: { [key: string]: string } = {}; // Respostas dos campos de input\r\n  cduAnswers: { [key: string]: { centena: string; dezena: string; unidade: string } } = {}; // Respostas C D U\r\n  \r\n  correctAnswers = 0;\r\n  totalQuestions = 0;\r\n  wrongAnswers = 0;\r\n  showBonusChallenge = false;\r\n  bonusChallengeCompleted = false;\r\n  completedActivities: boolean[] = [];\r\n  bonusAnswerSelected: string | null = null;\r\n  showHeartAnimation = false;\r\n  showFinalCard = false;\r\n  showCoinsLossCard = false;\r\n  coinsLost = 0;\r\n\r\n  constructor(\r\n    private route: ActivatedRoute,\r\n    private router: Router,\r\n    private missionsService: MissionsService,\r\n    public gameService: GameService,\r\n    private rewardsService: MissionRewardsService\r\n  ) {}\r\n\r\n  ngOnInit(): void {\r\n    this.route.paramMap.subscribe(params => {\r\n      const id = Number(params.get('id'));\r\n      this.loadMission(id);\r\n    });\r\n\r\n    this.gameService.player$.subscribe(player => {\r\n      if (this.showBonusChallenge && !this.bonusChallengeCompleted && player.hearts > 0) {\r\n        this.bonusChallengeCompleted = true;\r\n        this.showBonusChallenge = false;\r\n        this.enableAllActivities();\r\n      }\r\n    });\r\n  }\r\n\r\n  loadMission(id: number): void {\r\n    this.mission = this.missionsService.getMissionById(id);\r\n    this.allActivitiesCompleted = false;\r\n    this.showOriginalImage = !(this.mission?.textContent || this.mission?.textImages);\r\n    this.selectedMatches = {};\r\n    this.selectedImageForMatch = {};\r\n    this.environmentAnswers = {};\r\n    this.shuffledMatchPairs = {};\r\n    this.shuffledOptions = {};\r\n    this.inputAnswers = {};\r\n    this.cduAnswers = {};\r\n    \r\n    if (this.mission) {\r\n      this.mission.activities.forEach((activity, activityIndex) => {\r\n        if (activity.type === 'match' && activity.matchPairs) {\r\n          this.shuffleMatchPairs(activityIndex, activity.matchPairs);\r\n        } else if (activity.type === 'multiple-choice' && activity.options) {\r\n          this.shuffleOptions(activityIndex, activity.options);\r\n        }\r\n      });\r\n    }\r\n    this.correctAnswers = 0;\r\n    this.totalQuestions = 0;\r\n    if (this.mission) {\r\n      this.mission.activities.forEach(activity => {\r\n        if (activity.type === 'match' && activity.matchPairs) {\r\n          this.totalQuestions += activity.matchPairs.length;\r\n        } else {\r\n          this.totalQuestions += 1;\r\n        }\r\n      });\r\n    }\r\n    this.wrongAnswers = 0;\r\n    this.showBonusChallenge = false;\r\n    this.bonusChallengeCompleted = false;\r\n    this.bonusAnswerSelected = null;\r\n    this.showHeartAnimation = false;\r\n    this.showCoinsLossCard = false;\r\n    this.coinsLost = 0;\r\n    this.completedActivities = new Array(this.totalQuestions).fill(false);\r\n    \r\n    if (!this.mission) {\r\n      this.router.navigate(['/missions']);\r\n      return;\r\n    }\r\n    \r\n    setTimeout(() => {\r\n      const buttons = document.querySelectorAll('.activity-item .option-btn');\r\n      buttons.forEach((btn: any) => {\r\n        btn.disabled = false;\r\n        btn.classList.remove('correct', 'incorrect', 'selected');\r\n      });\r\n      \r\n      const successSection = document.getElementById('success-section');\r\n      if (successSection) {\r\n        successSection.style.display = 'none';\r\n      }\r\n    }, 100);\r\n  }\r\n\r\n  toggleOriginalImage(): void {\r\n    this.showOriginalImage = !this.showOriginalImage;\r\n  }\r\n\r\n  getTextParagraphs(): string[] {\r\n    if (!this.mission || !this.mission.textContent) {\r\n      return [];\r\n    }\r\n    return this.mission.textContent.split('\\n').filter(p => p.trim());\r\n  }\r\n\r\n  hasImagesInOptions(activity: Activity): boolean {\r\n    return activity.options?.some(opt => !!opt.image) || false;\r\n  }\r\n\r\n  goBack(): void {\r\n    this.router.navigate(['/missions']);\r\n  }\r\n\r\n  checkAnswer(activityIndex: number, optionIndex: number, isCorrect: boolean, option?: any): void {\r\n    if (!this.mission) return;\r\n    \r\n    const player = this.gameService.getPlayer();\r\n    if (player.hearts === 0 && !this.bonusChallengeCompleted) {\r\n      this.checkForBonusChallenge();\r\n      return;\r\n    }\r\n    \r\n    if (this.showBonusChallenge && !this.bonusChallengeCompleted) {\r\n      return;\r\n    }\r\n    \r\n    const activity = this.mission.activities[activityIndex];\r\n    const options = this.shuffledOptions[activityIndex] || activity.options || [];\r\n    const buttons = document.querySelectorAll(`.activity-item:nth-child(${activityIndex + 1}) .option-btn`) as NodeListOf<HTMLElement>;\r\n    \r\n    if (activity.allowMultiple) {\r\n      const clickedBtn = buttons[optionIndex];\r\n      const wasSelected = clickedBtn.classList.contains('selected');\r\n      \r\n      if (wasSelected) {\r\n        clickedBtn.classList.remove('selected', isCorrect ? 'correct' : 'incorrect');\r\n      } else {\r\n        clickedBtn.classList.add('selected');\r\n        clickedBtn.classList.add(isCorrect ? 'correct' : 'incorrect');\r\n        \r\n        if (!isCorrect) {\r\n          this.wrongAnswers++;\r\n          this.gameService.loseHeart();\r\n          this.checkForBonusChallenge();\r\n        }\r\n      }\r\n      \r\n      const allCorrectSelected = options.every((opt: any, idx: number) => {\r\n        if (opt.correct) {\r\n          return buttons[idx].classList.contains('selected');\r\n        }\r\n        return true;\r\n      });\r\n      \r\n      const noIncorrectSelected = options.every((opt: any, idx: number) => {\r\n        if (!opt.correct) {\r\n          return !buttons[idx].classList.contains('selected');\r\n        }\r\n        return true;\r\n      });\r\n      \r\n      const activityCorrect = allCorrectSelected && noIncorrectSelected;\r\n      \r\n      if (allCorrectSelected && activityCorrect && !this.completedActivities[activityIndex]) {\r\n        this.completedActivities[activityIndex] = true;\r\n        this.correctAnswers++;\r\n        buttons.forEach((btn: any) => {\r\n          btn.disabled = true;\r\n          options.forEach((opt: any, idx: number) => {\r\n            if (!opt.correct && !buttons[idx].classList.contains('selected')) {\r\n              buttons[idx].classList.add('incorrect');\r\n            }\r\n          });\r\n        });\r\n        this.checkAllActivitiesCompleted();\r\n      } else if (!activityCorrect && this.completedActivities[activityIndex]) {\r\n        this.completedActivities[activityIndex] = false;\r\n        this.correctAnswers--;\r\n      } else if (activityCorrect) {\r\n        this.checkAllActivitiesCompleted();\r\n      }\r\n    } else {\r\n      buttons.forEach((btn: any, index: number) => {\r\n        btn.disabled = true;\r\n        const currentOption = options[index];\r\n        \r\n        if (index === optionIndex) {\r\n          btn.classList.add(isCorrect ? 'correct' : 'incorrect');\r\n        } else if (isCorrect) {\r\n          if (currentOption && currentOption.correct) {\r\n            btn.classList.add('correct');\r\n          }\r\n        }\r\n      });\r\n      \r\n      if (isCorrect && !this.completedActivities[activityIndex]) {\r\n        this.completedActivities[activityIndex] = true;\r\n        this.correctAnswers++;\r\n      } else if (!isCorrect) {\r\n        this.wrongAnswers++;\r\n        this.gameService.loseHeart();\r\n        this.checkForBonusChallenge();\r\n      }\r\n      \r\n      this.checkAllActivitiesCompleted();\r\n    }\r\n  }\r\n  \r\n  checkForBonusChallenge(): void {\r\n    const player = this.gameService.getPlayer();\r\n    if (player.hearts === 0 && !this.bonusChallengeCompleted) {\r\n      if (!this.showBonusChallenge) {\r\n        this.showBonusChallenge = true;\r\n        this.disableAllActivities();\r\n        const successSection = document.getElementById('success-section');\r\n        if (successSection) {\r\n          successSection.style.display = 'none';\r\n        }\r\n        window.scrollTo({ top: 0, behavior: 'smooth' });\r\n      }\r\n    }\r\n  }\r\n  \r\n  closeBonusPopup(): void {\r\n    // Não permitir fechar o popup sem completar o desafio\r\n    // O popup só fecha quando o desafio é completado\r\n  }\r\n  \r\n  disableAllActivities(): void {\r\n    if (!this.mission) return;\r\n    \r\n    this.mission.activities.forEach((activity, activityIndex) => {\r\n      const buttons = document.querySelectorAll(`.activity-item:nth-child(${activityIndex + 1}) .option-btn`);\r\n      buttons.forEach((btn: any) => {\r\n        if (!btn.disabled || !btn.classList.contains('correct')) {\r\n          btn.disabled = true;\r\n          btn.style.opacity = '0.5';\r\n          btn.style.cursor = 'not-allowed';\r\n        }\r\n      });\r\n    });\r\n  }\r\n  \r\n  enableAllActivities(): void {\r\n    if (!this.mission) return;\r\n    \r\n    this.mission.activities.forEach((activity, activityIndex) => {\r\n      if (!this.completedActivities[activityIndex]) {\r\n        const buttons = document.querySelectorAll(`.activity-item:nth-child(${activityIndex + 1}) .option-btn`);\r\n        buttons.forEach((btn: any) => {\r\n          if (!btn.classList.contains('correct')) {\r\n            btn.disabled = false;\r\n            btn.style.opacity = '1';\r\n            btn.style.cursor = 'pointer';\r\n          }\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  checkTrueFalse(activityIndex: number, userAnswer: boolean, isCorrect: boolean): void {\r\n    if (!this.mission) return;\r\n    \r\n    const player = this.gameService.getPlayer();\r\n    if (player.hearts === 0 && !this.bonusChallengeCompleted) {\r\n      this.checkForBonusChallenge();\r\n      return;\r\n    }\r\n    \r\n    if (this.showBonusChallenge && !this.bonusChallengeCompleted) {\r\n      return;\r\n    }\r\n    \r\n    const isActivityCorrect = isCorrect === userAnswer;\r\n    if (isActivityCorrect && !this.completedActivities[activityIndex]) {\r\n      this.completedActivities[activityIndex] = true;\r\n      this.correctAnswers++;\r\n    } else if (!isActivityCorrect) {\r\n      this.wrongAnswers++;\r\n      this.gameService.loseHeart();\r\n      this.checkForBonusChallenge();\r\n    }\r\n    \r\n    const buttons = document.querySelectorAll(`.activity-item:nth-child(${activityIndex + 1}) .option-btn`);\r\n    buttons.forEach((btn: any) => {\r\n      btn.disabled = true;\r\n      const isTrueBtn = btn.textContent.includes('Verdadeiro');\r\n      if ((isTrueBtn && userAnswer) || (!isTrueBtn && !userAnswer)) {\r\n        btn.classList.add(isCorrect ? 'correct' : 'incorrect');\r\n      } else {\r\n        btn.classList.add(!isCorrect ? 'correct' : 'incorrect');\r\n      }\r\n    });\r\n    \r\n    this.checkAllActivitiesCompleted();\r\n  }\r\n\r\n  checkAllActivitiesCompleted(): void {\r\n    if (!this.mission) return;\r\n    \r\n    let allCompleted = true;\r\n    \r\n    this.mission.activities.forEach((activity, activityIndex) => {\r\n      if (activity.type === 'multiple-choice' || activity.type === 'true-false') {\r\n        if (activity.allowMultiple) {\r\n          if (!this.completedActivities[activityIndex]) {\r\n            allCompleted = false;\r\n          }\r\n        } else {\r\n          const buttons = document.querySelectorAll(`.activity-item:nth-child(${activityIndex + 1}) .option-btn`);\r\n          const allDisabled = Array.from(buttons).every((btn: any) => btn.disabled);\r\n          if (!allDisabled) {\r\n            allCompleted = false;\r\n          }\r\n        }\r\n      } else if (activity.type === 'match') {\r\n        if (activity.matchPairs) {\r\n          const allMatched = activity.matchPairs.every((pair, idx) => {\r\n            const key = `${activityIndex}-${pair.matchId}`;\r\n            return this.selectedMatches[key] === pair.description;\r\n          });\r\n          if (!allMatched) {\r\n            allCompleted = false;\r\n          }\r\n        }\r\n      } else if (activity.type === 'environment-check') {\r\n        if (activity.environmentImages) {\r\n          const allAnswered = activity.environmentImages.every((_, idx) => {\r\n            return this.environmentAnswers[idx] !== null && this.environmentAnswers[idx] !== undefined;\r\n          });\r\n          if (!allAnswered) {\r\n            allCompleted = false;\r\n          }\r\n        }\r\n      } else if (activity.type === 'fill-blank' || activity.type === 'math-input') {\r\n        if (!this.completedActivities[activityIndex]) {\r\n          allCompleted = false;\r\n        }\r\n      } else if (activity.type === 'cdu-operation') {\r\n        if (!this.completedActivities[activityIndex]) {\r\n          allCompleted = false;\r\n        }\r\n      } else if (activity.type === 'visual-multiplication') {\r\n        if (!this.completedActivities[activityIndex]) {\r\n          allCompleted = false;\r\n        }\r\n      }\r\n    });\r\n    \r\n    if (allCompleted && !this.allActivitiesCompleted) {\r\n      this.allActivitiesCompleted = true;\r\n      const player = this.gameService.getPlayer();\r\n      if (player.hearts === 0 && !this.bonusChallengeCompleted) {\r\n        this.checkForBonusChallenge();\r\n        return;\r\n      }\r\n      setTimeout(() => {\r\n        this.showSuccessMessage();\r\n      }, 1000);\r\n    }\r\n  }\r\n\r\n  showSuccessMessage(): void {\r\n    if (this.mission) {\r\n      if (this.showBonusChallenge && !this.bonusChallengeCompleted) {\r\n        return;\r\n      }\r\n      \r\n      this.missionsService.markMissionAsCompleted(this.mission.id);\r\n      \r\n      const reward = this.rewardsService.getReward(this.mission.id);\r\n      if (reward) {\r\n        this.gameService.completeMission(reward, this.correctAnswers, this.totalQuestions);\r\n      }\r\n      \r\n      const successSection = document.getElementById('success-section');\r\n      if (successSection) {\r\n        successSection.style.display = 'block';\r\n        successSection.scrollIntoView({ behavior: 'smooth' });\r\n      }\r\n    }\r\n  }\r\n\r\n  selectBonusAnswer(answer: string): void {\r\n    this.bonusAnswerSelected = answer;\r\n  }\r\n\r\n  completeBonusChallenge(): void {\r\n    if (!this.mission || !this.bonusAnswerSelected) return;\r\n    \r\n    let correctAnswer: string;\r\n    if (this.mission.bonusQuestion) {\r\n      correctAnswer = this.mission.bonusCorrectAnswer || \"Sim\";\r\n    } else {\r\n      correctAnswer = \"Somar um número várias vezes\";\r\n    }\r\n    \r\n    const isCorrect = this.bonusAnswerSelected === correctAnswer;\r\n    \r\n    if (isCorrect) {\r\n      this.gameService.recoverHeart();\r\n      this.bonusChallengeCompleted = true;\r\n      this.showBonusChallenge = false;\r\n      this.enableAllActivities();\r\n      this.showHeartAnimation = true;\r\n      setTimeout(() => {\r\n        this.showHeartAnimation = false;\r\n        if (this.allActivitiesCompleted) {\r\n          this.showSuccessMessage();\r\n        } else {\r\n          this.checkAllActivitiesCompleted();\r\n        }\r\n      }, 3000);\r\n    } else {\r\n      const player = this.gameService.getPlayer();\r\n      const livesLost = player.maxHearts - player.hearts;\r\n      const coinsToDeduct = livesLost * 3;\r\n      \r\n      if (coinsToDeduct > 0) {\r\n        this.coinsLost = coinsToDeduct;\r\n        this.gameService.removeCoins(coinsToDeduct);\r\n        this.showCoinsLossCard = true;\r\n        setTimeout(() => {\r\n          this.showCoinsLossCard = false;\r\n        }, 3000);\r\n      }\r\n      \r\n      this.bonusAnswerSelected = null;\r\n      this.showBonusChallenge = true;\r\n      this.disableAllActivities();\r\n      window.scrollTo({ top: 0, behavior: 'smooth' });\r\n    }\r\n  }\r\n\r\n  nextMission(): void {\r\n    if (!this.mission) return;\r\n    \r\n    const nextId = this.mission.id + 1;\r\n    const nextMission = this.missionsService.getMissionById(nextId);\r\n    \r\n    if (nextMission) {\r\n      this.router.navigate(['/mission', nextId]).then(() => {\r\n        window.scrollTo({ top: 0, behavior: 'smooth' });\r\n      });\r\n    } else {\r\n      this.showFinalCard = true;\r\n      window.scrollTo({ top: 0, behavior: 'smooth' });\r\n    }\r\n  }\r\n\r\n  closeFinalCard(): void {\r\n    this.showFinalCard = false;\r\n    this.router.navigate(['/missions']);\r\n  }\r\n\r\n  shuffleOptions(activityIndex: number, options: any[]): void {\r\n    const shuffle = (array: any[]) => {\r\n      const shuffled = [...array];\r\n      for (let i = shuffled.length - 1; i > 0; i--) {\r\n        const j = Math.floor(Math.random() * (i + 1));\r\n        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];\r\n      }\r\n      return shuffled;\r\n    };\r\n    \r\n    this.shuffledOptions[activityIndex] = shuffle(options);\r\n  }\r\n\r\n  shuffleMatchPairs(activityIndex: number, matchPairs: any[]): void {\r\n    const images = [...matchPairs];\r\n    const texts = [...matchPairs];\r\n    \r\n    const shuffle = (array: any[]) => {\r\n      const shuffled = [...array];\r\n      for (let i = shuffled.length - 1; i > 0; i--) {\r\n        const j = Math.floor(Math.random() * (i + 1));\r\n        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];\r\n      }\r\n      return shuffled;\r\n    };\r\n    \r\n    this.shuffledMatchPairs[activityIndex] = {\r\n      images: shuffle(images),\r\n      texts: shuffle(texts)\r\n    };\r\n  }\r\n\r\n  selectImageForMatch(activityIndex: number, imageId: string): void {\r\n    if (!this.mission) return;\r\n    \r\n    const player = this.gameService.getPlayer();\r\n    if (player.hearts === 0 && !this.bonusChallengeCompleted) {\r\n      this.checkForBonusChallenge();\r\n      return;\r\n    }\r\n    \r\n    if (this.showBonusChallenge && !this.bonusChallengeCompleted) {\r\n      return;\r\n    }\r\n    \r\n    if (this.selectedImageForMatch[activityIndex] === imageId) {\r\n      this.selectedImageForMatch[activityIndex] = null;\r\n    } else {\r\n      this.selectedImageForMatch[activityIndex] = imageId;\r\n    }\r\n  }\r\n\r\n  selectMatch(activityIndex: number, imageId: string, description: string): void {\r\n    if (!this.mission) return;\r\n    \r\n    const player = this.gameService.getPlayer();\r\n    if (player.hearts === 0 && !this.bonusChallengeCompleted) {\r\n      this.checkForBonusChallenge();\r\n      return;\r\n    }\r\n    \r\n    if (this.showBonusChallenge && !this.bonusChallengeCompleted) {\r\n      return;\r\n    }\r\n    \r\n    if (!this.selectedImageForMatch[activityIndex]) {\r\n      return;\r\n    }\r\n    \r\n    const selectedImageId = this.selectedImageForMatch[activityIndex];\r\n    const key = `${activityIndex}-${selectedImageId}`;\r\n    \r\n    const activity = this.mission.activities[activityIndex];\r\n    if (activity.matchPairs) {\r\n      const correctPair = activity.matchPairs.find(pair => pair.matchId === selectedImageId);\r\n      const isCorrect = correctPair && correctPair.description === description;\r\n      \r\n      if (isCorrect) {\r\n        const wasAlreadyMatched = this.selectedMatches[key] !== undefined;\r\n        this.selectedMatches[key] = description;\r\n        \r\n        if (!wasAlreadyMatched) {\r\n          this.correctAnswers++;\r\n        }\r\n        \r\n        this.selectedImageForMatch[activityIndex] = null;\r\n      } else {\r\n        this.wrongAnswers++;\r\n        this.gameService.loseHeart();\r\n        this.checkForBonusChallenge();\r\n        this.selectedImageForMatch[activityIndex] = null;\r\n      }\r\n      \r\n      const allCorrect = activity.matchPairs.every(pair => {\r\n        const matchKey = `${activityIndex}-${pair.matchId}`;\r\n        return this.selectedMatches[matchKey] === pair.description;\r\n      });\r\n      \r\n      const allMatched = activity.matchPairs.every(pair => {\r\n        const matchKey = `${activityIndex}-${pair.matchId}`;\r\n        return this.selectedMatches[matchKey] !== undefined;\r\n      });\r\n      \r\n      if (allCorrect && allMatched && !this.completedActivities[activityIndex]) {\r\n        this.completedActivities[activityIndex] = true;\r\n        this.checkAllActivitiesCompleted();\r\n      } else if ((!allCorrect || !allMatched) && this.completedActivities[activityIndex]) {\r\n        this.completedActivities[activityIndex] = false;\r\n      }\r\n    }\r\n  }\r\n\r\n  checkEnvironment(activityIndex: number, imageIndex: number, hasProblem: boolean): void {\r\n    if (!this.mission) return;\r\n    \r\n    const player = this.gameService.getPlayer();\r\n    if (player.hearts === 0 && !this.bonusChallengeCompleted) {\r\n      this.checkForBonusChallenge();\r\n      return;\r\n    }\r\n    \r\n    if (this.showBonusChallenge && !this.bonusChallengeCompleted) {\r\n      return;\r\n    }\r\n    const activity = this.mission.activities[activityIndex];\r\n    if (activity.type === 'environment-check' && activity.environmentImages) {\r\n      this.environmentAnswers[imageIndex] = hasProblem;\r\n      \r\n      const correct = activity.environmentImages[imageIndex].hasProblem === hasProblem;\r\n      \r\n      const allAnswered = activity.environmentImages.every((img, idx) => {\r\n        return this.environmentAnswers[idx] !== null && this.environmentAnswers[idx] !== undefined;\r\n      });\r\n      \r\n      let allImagesCorrect = true;\r\n      for (let i = 0; i < activity.environmentImages.length; i++) {\r\n        const img = activity.environmentImages[i];\r\n        const userAnswer = this.environmentAnswers[i];\r\n        if (userAnswer === null || userAnswer === undefined) {\r\n          allImagesCorrect = false;\r\n          break;\r\n        }\r\n        if (userAnswer !== img.hasProblem) {\r\n          allImagesCorrect = false;\r\n          break;\r\n        }\r\n      }\r\n      \r\n      if (allImagesCorrect && allAnswered && !this.completedActivities[activityIndex]) {\r\n        this.completedActivities[activityIndex] = true;\r\n        this.correctAnswers++;\r\n        this.checkAllActivitiesCompleted();\r\n      } else if ((!allImagesCorrect || !allAnswered) && this.completedActivities[activityIndex]) {\r\n        this.completedActivities[activityIndex] = false;\r\n        this.correctAnswers--;\r\n      } else if (!correct) {\r\n        this.wrongAnswers++;\r\n        this.gameService.loseHeart();\r\n        this.checkForBonusChallenge();\r\n      }\r\n    }\r\n  }\r\n\r\n  isEnvironmentCorrect(imageIndex: number): boolean | null {\r\n    return this.environmentAnswers[imageIndex] ?? null;\r\n  }\r\n\r\n  getCurrentHeartsArray(): boolean[] {\r\n    const player = this.gameService.getPlayer();\r\n    return Array(player.maxHearts).fill(false).map((_, i) => i < player.hearts);\r\n  }\r\n\r\n  // Métodos para campos de input\r\n  getInputKey(activityIndex: number, fieldIndex: number): string {\r\n    return `${activityIndex}-${fieldIndex}`;\r\n  }\r\n\r\n  getInputValue(activityIndex: number, fieldIndex: number): string {\r\n    return this.inputAnswers[this.getInputKey(activityIndex, fieldIndex)] || '';\r\n  }\r\n\r\n  setInputValue(activityIndex: number, fieldIndex: number, value: string): void {\r\n    const key = this.getInputKey(activityIndex, fieldIndex);\r\n    this.inputAnswers[key] = value;\r\n    \r\n    // Verificar tipo de atividade\r\n    if (this.mission) {\r\n      const activity = this.mission.activities[activityIndex];\r\n      if (activity.type === 'visual-multiplication') {\r\n        setTimeout(() => {\r\n          this.checkVisualMultiplication(activityIndex);\r\n        }, 100);\r\n      } else {\r\n        this.checkInputActivity(activityIndex);\r\n      }\r\n    }\r\n  }\r\n\r\n  checkInputActivity(activityIndex: number): void {\r\n    if (!this.mission) return;\r\n    \r\n    const player = this.gameService.getPlayer();\r\n    if (player.hearts === 0 && !this.bonusChallengeCompleted) {\r\n      this.checkForBonusChallenge();\r\n      return;\r\n    }\r\n    \r\n    if (this.showBonusChallenge && !this.bonusChallengeCompleted) {\r\n      return;\r\n    }\r\n    \r\n    const activity = this.mission.activities[activityIndex];\r\n    if (activity.type === 'fill-blank' || activity.type === 'math-input') {\r\n      if (activity.inputFields) {\r\n        // Verificar se todos os campos estão preenchidos\r\n        let allFilled = true;\r\n        activity.inputFields.forEach((field, fieldIndex) => {\r\n          const key = this.getInputKey(activityIndex, fieldIndex);\r\n          const userAnswer = this.inputAnswers[key] || '';\r\n          if (!userAnswer.trim()) {\r\n            allFilled = false;\r\n          }\r\n        });\r\n        \r\n        if (!allFilled) {\r\n          return; // Ainda não preencheu tudo\r\n        }\r\n        \r\n        let allCorrect = true;\r\n        let hasError = false;\r\n        activity.inputFields.forEach((field, fieldIndex) => {\r\n          const key = this.getInputKey(activityIndex, fieldIndex);\r\n          const userAnswer = this.inputAnswers[key] || '';\r\n          const correctValue = String(field.correctValue).trim().toLowerCase();\r\n          const userValue = userAnswer.trim().toLowerCase();\r\n          \r\n          if (userValue !== correctValue) {\r\n            allCorrect = false;\r\n            hasError = true;\r\n          }\r\n        });\r\n        \r\n        if (allCorrect && !this.completedActivities[activityIndex]) {\r\n          this.completedActivities[activityIndex] = true;\r\n          this.correctAnswers++;\r\n          this.checkAllActivitiesCompleted();\r\n        } else if (!allCorrect && this.completedActivities[activityIndex]) {\r\n          this.completedActivities[activityIndex] = false;\r\n          this.correctAnswers--;\r\n        } else if (hasError && !this.completedActivities[activityIndex]) {\r\n          // Erro ao tentar completar - perde uma vida\r\n          this.wrongAnswers++;\r\n          this.gameService.loseHeart();\r\n          this.checkForBonusChallenge();\r\n        }\r\n      }\r\n    } else if (activity.type === 'cdu-operation' && activity.cduOperation) {\r\n      const op = activity.cduOperation;\r\n      const key = `${activityIndex}-cdu`;\r\n      const userCDU = this.cduAnswers[key];\r\n      \r\n      if (userCDU && userCDU.centena && userCDU.dezena && userCDU.unidade) {\r\n        const userCentena = parseInt(userCDU.centena) || 0;\r\n        const userDezena = parseInt(userCDU.dezena) || 0;\r\n        const userUnidade = parseInt(userCDU.unidade) || 0;\r\n        const userAnswer = userCentena * 100 + userDezena * 10 + userUnidade;\r\n        \r\n        const correct = userAnswer === op.correctAnswer;\r\n        \r\n        if (correct && !this.completedActivities[activityIndex]) {\r\n          this.completedActivities[activityIndex] = true;\r\n          this.correctAnswers++;\r\n          this.checkAllActivitiesCompleted();\r\n        } else if (!correct && this.completedActivities[activityIndex]) {\r\n          this.completedActivities[activityIndex] = false;\r\n          this.correctAnswers--;\r\n        } else if (!correct && !this.completedActivities[activityIndex]) {\r\n          // Erro ao tentar completar - perde uma vida\r\n          this.wrongAnswers++;\r\n          this.gameService.loseHeart();\r\n          this.checkForBonusChallenge();\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  getCDUValue(activityIndex: number, position: 'centena' | 'dezena' | 'unidade'): string {\r\n    const key = `${activityIndex}-cdu`;\r\n    return this.cduAnswers[key]?.[position] || '';\r\n  }\r\n\r\n  setCDUValue(activityIndex: number, position: 'centena' | 'dezena' | 'unidade', value: string): void {\r\n    const key = `${activityIndex}-cdu`;\r\n    if (!this.cduAnswers[key]) {\r\n      this.cduAnswers[key] = { centena: '', dezena: '', unidade: '' };\r\n    }\r\n    this.cduAnswers[key][position] = value;\r\n    this.checkInputActivity(activityIndex);\r\n  }\r\n\r\n  isCDUCorrect(activityIndex: number): boolean | null {\r\n    if (!this.mission) return null;\r\n    const activity = this.mission.activities[activityIndex];\r\n    if (activity.type !== 'cdu-operation' || !activity.cduOperation) return null;\r\n    \r\n    const key = `${activityIndex}-cdu`;\r\n    const userCDU = this.cduAnswers[key];\r\n    if (!userCDU || !userCDU.centena || !userCDU.dezena || !userCDU.unidade) return null;\r\n    \r\n    const userCentena = parseInt(userCDU.centena) || 0;\r\n    const userDezena = parseInt(userCDU.dezena) || 0;\r\n    const userUnidade = parseInt(userCDU.unidade) || 0;\r\n    const userAnswer = userCentena * 100 + userDezena * 10 + userUnidade;\r\n    \r\n    return userAnswer === activity.cduOperation.correctAnswer;\r\n  }\r\n\r\n  isInputFieldCorrect(activityIndex: number, fieldIndex: number): boolean | null {\r\n    if (!this.mission) return null;\r\n    const activity = this.mission.activities[activityIndex];\r\n    if ((activity.type !== 'fill-blank' && activity.type !== 'math-input') || !activity.inputFields) return null;\r\n    \r\n    const field = activity.inputFields[fieldIndex];\r\n    if (!field) return null;\r\n    \r\n    const key = this.getInputKey(activityIndex, fieldIndex);\r\n    const userAnswer = this.inputAnswers[key] || '';\r\n    if (!userAnswer) return null;\r\n    \r\n    const correctValue = String(field.correctValue).trim().toLowerCase();\r\n    const userValue = userAnswer.trim().toLowerCase();\r\n    \r\n    return userValue === correctValue;\r\n  }\r\n\r\n  getCDUDisplay(number: number, position: number): string {\r\n    const str = String(number).padStart(3, '0');\r\n    return str[position] || '0';\r\n  }\r\n\r\n  // Métodos para Visual Multiplication\r\n  checkVisualMultiplication(activityIndex: number): void {\r\n    if (!this.mission) return;\r\n    \r\n    const player = this.gameService.getPlayer();\r\n    if (player.hearts === 0 && !this.bonusChallengeCompleted) {\r\n      this.checkForBonusChallenge();\r\n      return;\r\n    }\r\n    \r\n    if (this.showBonusChallenge && !this.bonusChallengeCompleted) {\r\n      return;\r\n    }\r\n    \r\n    const activity = this.mission.activities[activityIndex];\r\n    if (activity.type !== 'visual-multiplication' || !activity.visualMultiplication) return;\r\n    \r\n    const vm = activity.visualMultiplication;\r\n    \r\n    // Verificar se todos os campos estão preenchidos\r\n    let allFilled = true;\r\n    vm.inputFields.forEach((field, fieldIndex) => {\r\n      const key = this.getInputKey(activityIndex, fieldIndex);\r\n      const userAnswer = this.inputAnswers[key] || '';\r\n      if (!userAnswer.trim()) {\r\n        allFilled = false;\r\n      }\r\n    });\r\n    \r\n    if (!allFilled) {\r\n      return; // Ainda não preencheu tudo\r\n    }\r\n    \r\n    // Construir a resposta do usuário\r\n    const num1 = this.inputAnswers[this.getInputKey(activityIndex, 0)] || '';\r\n    const num2 = this.inputAnswers[this.getInputKey(activityIndex, 1)] || '';\r\n    const result = this.inputAnswers[this.getInputKey(activityIndex, 2)] || '';\r\n    \r\n    const userAnswer1 = `${num1} x ${num2} = ${result}`;\r\n    const userAnswer2 = `${num2} x ${num1} = ${result}`;\r\n    \r\n    // Verificar se a resposta está nas respostas corretas\r\n    const isCorrect = vm.correctAnswers.some(correct => {\r\n      const normalizedCorrect = correct.trim().toLowerCase();\r\n      return normalizedCorrect === userAnswer1.trim().toLowerCase() || \r\n             normalizedCorrect === userAnswer2.trim().toLowerCase();\r\n    });\r\n    \r\n    if (isCorrect && !this.completedActivities[activityIndex]) {\r\n      this.completedActivities[activityIndex] = true;\r\n      this.correctAnswers++;\r\n      this.checkAllActivitiesCompleted();\r\n    } else if (!isCorrect && this.completedActivities[activityIndex]) {\r\n      this.completedActivities[activityIndex] = false;\r\n      this.correctAnswers--;\r\n    } else if (!isCorrect && !this.completedActivities[activityIndex]) {\r\n      // Erro ao tentar completar - perde uma vida\r\n      this.wrongAnswers++;\r\n      this.gameService.loseHeart();\r\n      this.checkForBonusChallenge();\r\n    }\r\n  }\r\n\r\n  getVisualMultiplicationValue(activityIndex: number, fieldIndex: number): string {\r\n    return this.getInputValue(activityIndex, fieldIndex);\r\n  }\r\n\r\n  setVisualMultiplicationValue(activityIndex: number, fieldIndex: number, value: string): void {\r\n    this.setInputValue(activityIndex, fieldIndex, value);\r\n    // Verificar após atualizar\r\n    setTimeout(() => {\r\n      this.checkVisualMultiplication(activityIndex);\r\n    }, 100);\r\n  }\r\n\r\n  isVisualMultiplicationCorrect(activityIndex: number): boolean | null {\r\n    if (!this.mission) return null;\r\n    const activity = this.mission.activities[activityIndex];\r\n    if (activity.type !== 'visual-multiplication' || !activity.visualMultiplication) return null;\r\n    \r\n    const vm = activity.visualMultiplication;\r\n    const num1 = this.inputAnswers[this.getInputKey(activityIndex, 0)] || '';\r\n    const num2 = this.inputAnswers[this.getInputKey(activityIndex, 1)] || '';\r\n    const result = this.inputAnswers[this.getInputKey(activityIndex, 2)] || '';\r\n    \r\n    if (!num1 || !num2 || !result) return null;\r\n    \r\n    const userAnswer1 = `${num1} x ${num2} = ${result}`;\r\n    const userAnswer2 = `${num2} x ${num1} = ${result}`;\r\n    \r\n    const isCorrect = vm.correctAnswers.some(correct => {\r\n      const normalizedCorrect = correct.trim().toLowerCase();\r\n      return normalizedCorrect === userAnswer1.trim().toLowerCase() || \r\n             normalizedCorrect === userAnswer2.trim().toLowerCase();\r\n    });\r\n    \r\n    return isCorrect;\r\n  }\r\n}\r\n\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}